name: Publish Docs

on:
  pull_request:
    branches: [publish]

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
        with:
          version: 8
      - name: Install Dependencies
        run: pnpm i
      - name: Build
        run: |
          node --version
          pnpm --filter h-ui-plus-docs docs:build
#        run: pnpm -C ./packages/h-ui-plus-docs docs:build #不能用这个，真的是深渊巨坑。暂时推测是因为用这种方式，会导致package.json中依赖的为workspace的不会被替换为真正的依赖，导致打包失败
      - name: "Publish Docs" #本质就是发布到仓库的gh-pages分支。secrets.DOCS_GITHUB_TOKEN是本仓库的token
        run: |
          cd ./packages/h-ui-plus-docs/docs/.vitepress/dist
          git init --initial-branch=gh-pages
          git config --global user.email "1270433876@qq.com"
          git config --global user.name "Action Auto Publish"
          git add .
          git commit -m "docs:文档部署"
          git remote add origin https://${{secrets.DOCS_GITHUB_TOKEN}}@github.com/heyingjiee/h-ui-plus.git  
          git push -f -u  origin gh-pages